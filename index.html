<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>News Feed</title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue-red.min.css">
	<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
	<link rel="stylesheet" href="bundle.css">
</head>

<body>
	<div id="feedApp">
		<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
			<header class="mdl-layout__header">
				<div class="mdl-layout__header-row">
					<span class="mdl-layout-title">News Feed - American Express </span>
					<div class="mdl-layout-spacer"></div>
					<span class="mdl-layout-title">Hackerearth</span>
				</div>
			</header>
			<main class="mdl-layout__content page-content-holder">
				<div class="mdl-grid page-content">
					<div class="filters mdl-cell mdl-cell--3-col mdl-shadow--2dp">

						<form @submit.prevent.default="search">
							<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label search-box">
								<input class="mdl-textfield__input" type="text" id="searchBox" v-model="searchTerm">
								<label class="mdl-textfield__label" for="searchBox">Title or Publisher</label>
							</div>
						</form>

						<div class="sorter-holder">
							<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
								<input class="mdl-textfield__input" type="text" v-model="sorter.sortLabel" id="sorterHolder" readonly>
								<label class="mdl-textfield__label" for="sorterHolder">Sort by</label>
							</div>
							<ul class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect sorter-menu" for="sorterHolder">
								<li class="mdl-menu__item" v-for="sorter in sorters" @click="sort(sorter)">
									{{ sorter.sortLabel }}
								</li>
							</ul>
						</div>

						<h6>Select Category</h6>
						<div v-if="loading.categories" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
						<div v-else v-for="category in categories">
							<input type="checkbox" :id="'cat_'+category.id" v-model="category.selected" @change="onCategorySelected(category)">
							<label :for="'cat_'+category.id">{{ category.value }}</label>
						</div>

						<h6>Select Publisher</h6>
						<div v-if="loading.publishers" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
						<div v-else v-for="publ in publishers">
							<input type="checkbox" :id="'pub_'+publ.id" v-model="publ.selected" @change="onPublisherSelected(publ)">
							<label :for="'pub_'+publ.id">{{ publ.publisher }}</label>
						</div>
						<p v-if="countPublishers > publishers.length" @click="loadAllPublishers">SHOW ALL</p>

					</div>
					<div class="content mdl-cell mdl-cell--9-col">
						<div class="status-bar mr-lt mr-rt">
							<h6>{{ resultsDisplay }}</h6>
							<div class="mdl-layout-spacer"></div>
							<p v-if="firstVisible" class="page-control" @click="loadPage(1)">First</p>
							<p v-if="firstVisible" class="page-control" @click="loadPage(currPageNum - 1)">Prev</p>
							<p v-if="lastVisible" class="page-control" @click="loadPage(currPageNum + 1)">Next</p>
							<p v-if="lastVisible" class="page-control" @click="loadPage(lastPageNum)">Last</p>
						</div>
						<div class="applied-filters">
							<span v-if="displaySearchTerm" class="applied-filter mdl-chip">
    						<span class="mdl-chip__text">{{ displaySearchTerm }}</span>
							</span>
							<span v-if="sorter" class="applied-filter mdl-chip">
    						<span class="mdl-chip__text">{{ sorter ? sorter.sortLabel : "" }}</span>
							</span>
							<span class="applied-filter mdl-chip mdl-chip--deletable" v-for="catFilter in appliedFilters.getFilters(consts.category)">
    						<span class="mdl-chip__text">{{ catFilter.displayValue }}</span>
								<button type="button" class="mdl-chip__action" @click="removeCategoryFilter(catFilter.key)">
									<i class="material-icons">cancel</i>
								</button>
							</span>
							<span class="applied-filter mdl-chip mdl-chip--deletable" v-for="publFilter in appliedFilters.getFilters(consts.publisher)">
    						<span class="mdl-chip__text">{{ publFilter.displayValue }}</span>
								<button type="button" class="mdl-chip__action" @click="removePublisherFilter(publFilter.key)">
									<i class="material-icons">cancel</i>
								</button>
							</span>
						</div>
						<div v-if="loading.feeds" class="feeds-loader mdl-spinner mdl-js-spinner is-active"></div>
						<div class="feeds-holder mdl-grid">
							<div class="feed-item mdl-cell mdl-cell--6-col mdl-shadow--2dp" v-for="item in feeds">
								<p class="feed-item__title">{{ item.title }}</p>
								<p class="feed-item__publisher" :href="item.publisherUrl">{{ item.publisher }}</p>
								<p class="feed-item__category">{{ item.category }}</p>
								<p class="feed-item__published-on">{{ item.publishedOnStr }}</p>
							</div>
						</div>
						<div v-if="noFeeds" class="no-feeds">
							: (
						</div>
					</div>
				</div>
			</main>
			
			<dialog class="mdl-dialog all-pubs-dialog" id="allPubsDialog">
				<p class="mdl-dialog__title">All Publishers</p>
				<div class="mdl-dialog__content all-pubs">
					<div v-for="publ in allPublishers">
						<input type="checkbox" :id="'allPub_'+publ.id" v-model="publ.selected">
						<label :for="'allPub_'+publ.id">{{ publ.publisher }}</label>
					</div>
				</div>
				<div class="mdl-dialog__actions">
					<button type="button" class="mdl-button mdl-color--primary mdl-color-text--white" @click="selectPublishersFromDialog">Apply Filters</button>
					<button type="button" class="mdl-button" @click="closeAllPubsDialog">Cancel</button>
				</div>
			</dialog>

		</div>
	</div>
	<script src="bundle.js"></script>
</body>

</html>