<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>News Feed</title>
	<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue-red.min.css">
	<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
	<link rel="stylesheet" href="bundle.css">
</head>

<body>
	<div id="feedApp">
		<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
			<header class="mdl-layout__header">
				<div class="mdl-layout__header-row">
					<span class="mdl-layout-title">News Feed - American Express </span>
					<div class="mdl-layout-spacer"></div>
					<span class="mdl-layout-title">Hackerearth</span>
				</div>
			</header>
			<main class="mdl-layout__content page-content-holder">
				<div v-if="noNetwork" class="no-network">
					<p class="no-network__title">Couldn't connect to the servers!</p>
					<button class="mdl-button mdl-color--primary mdl-color-text--white mr-lt">
						Retry
					</button>
				</div>
				<div v-else class="mdl-grid page-content">
					<div class="filters mdl-cell mdl-cell--3-col mdl-shadow--2dp">

						<form @submit.prevent.default="search">
							<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label search-box">
								<input class="mdl-textfield__input" type="text" id="searchBox" v-model="searchTerm">
								<label class="mdl-textfield__label" for="searchBox">Search Title or Publisher</label>
							</div>
						</form>

						<div class="sorter-holder">
							<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
								<input class="mdl-textfield__input" type="text" v-model="sorter.sortLabel" id="sorterHolder" readonly>
								<label class="mdl-textfield__label" for="sorterHolder">Sort by</label>
							</div>
							<ul class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect sorter-menu" for="sorterHolder">
								<li class="mdl-menu__item" v-for="sorter in sorters" @click="sort(sorter)">
									{{ sorter.sortLabel }}
								</li>
							</ul>
						</div>

						<p class="filter__type mdl-color-text--primary">Select Category</p>
						<div v-if="loading.categories" class="mdl-progress mdl-js-progress mdl-progress__indeterminate  mdl-menu__item--full-bleed-divider"></div>
						<div v-else>
							<label v-for="category in categories" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" :for="'cat_'+category.id">
								<input type="checkbox" :id="'cat_'+category.id" v-model="category.selected" @change="onCategorySelected(category)" class="mdl-checkbox__input">
								<span class="mdl-checkbox__label filter__value">{{ category.value }}</span>
							</label>
						</div>

						<p class="filter__type mdl-color-text--primary">Select Publisher</p>
						<div v-if="loading.publishers" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
						<div v-else v-for="publ in publishers">
							<label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" :for="'pub_'+publ.id">
								<input type="checkbox" :id="'pub_'+publ.id" v-model="publ.selected" @change="onPublisherSelected(publ)" class="mdl-checkbox__input">
								<span class="mdl-checkbox__label filter__value">{{ publ.publisher }}</span>
							</label>
						</div>
						<button v-if="countPublishers > publishers.length" class="mdl-button mdl-js-button mdl-color-text--primary filter__show-all" @click="loadAllPublishers">SHOW ALL</button>
					</div>
					<div class="content mdl-cell mdl-cell--9-col">
						<div class="status-bar mr-lt">
							<h6>{{ resultsDisplay }}</h6>
							<div class="mdl-layout-spacer"></div>
							<div v-if="paginationVisible" class="flex-row">
								<button :disabled="!firstVisible" class="mdl-button mdl-js-button mdl-button--icon mdl-button--primary page-control" @click="loadPage(1)">
									<i class="material-icons">first_page</i>
								</button>
								<button :disabled="!firstVisible" class="mdl-button mdl-js-button mdl-button--icon mdl-button--primary page-control" @click="loadPage(currPageNum - 1)">
									<i class="material-icons">chevron_left</i>
								</button>
								<p class="page-control mdl-color-text--primary">Page {{ currPageNum }} of {{ lastPageNum }}</p>
								<button :disabled="!lastVisible" class="mdl-button mdl-js-button mdl-button--icon mdl-button--primary page-control" @click="
								loadPage(currPageNum + 1)">
									<i class="material-icons">chevron_right</i>
								</button>
								<button :disabled="!lastVisible" class="mdl-button mdl-js-button mdl-button--icon mdl-button--primary page-control" @click="loadPage(lastPageNum)">
									<i class="material-icons">last_page</i>
								</button>
							</div>
						</div>
						<div class="applied-filters">
							<span v-if="displaySearchTerm" class="applied-filter mdl-chip mdl-chip--deletable">
								<span class="mdl-chip__text">{{ displaySearchTerm }}</span>
								<button type="button" class="mdl-chip__action" @click="clearSearchTerm">
									<i class="material-icons">cancel</i>
								</button>
							</span>
							<span v-if="sorter" class="applied-filter mdl-chip">
								<span class="mdl-chip__text">{{ sorter ? sorter.sortLabel : "" }}</span>
							</span>
							<span class="applied-filter mdl-chip mdl-chip--deletable" v-for="catFilter in appliedFilters.getFilters(consts.category)">
								<span class="mdl-chip__text">{{ catFilter.displayValue }}</span>
								<button type="button" class="mdl-chip__action" @click="removeCategoryFilter(catFilter.key)">
									<i class="material-icons">cancel</i>
								</button>
							</span>
							<span class="applied-filter mdl-chip mdl-chip--deletable" v-for="publFilter in appliedFilters.getFilters(consts.publisher)">
								<span class="mdl-chip__text">{{ publFilter.displayValue }}</span>
								<button type="button" class="mdl-chip__action" @click="removePublisherFilter(publFilter.key)">
									<i class="material-icons">cancel</i>
								</button>
							</span>
						</div>
						<div class="feeds-holder mdl-grid">
							<div class="feed-item mdl-cell mdl-cell--6-col mdl-shadow--2dp" v-for="item in feeds">
								<a :href="item.publisherUrl">
									<span class="feed-item__publisher mdl-color-text--accent">{{ item.publisher }}</span>
								</a>
								<a :href="item.url">
									<p class="feed-item__title">{{ item.title }}</p>
								</a>
								<div class="mdl-layout-spacer"></div>
								<div class="feed-item__bottom-row">
									<i class="material-icons">{{ item.category.id === 'b' ? 'business' : 'laptop' }}</i>
									<span class="feed-item__category mr-lt--sm">{{ item.category.value }}</span>
									<div class="mdl-layout-spacer"></div>
									<span class="feed-item__published-on">{{ item.publishedOnStr }}</span>								
								</div>
							</div>
						</div>
						<div v-if="noFeeds" class="no-feeds">
							: (
						</div>
						<div class="flex-row" v-if="paginationVisible" class="status-bar mr-lt mr-rt">
							<div class="mdl-layout-spacer"></div>
							<button :disabled="!firstVisible" class="mdl-button mdl-js-button mdl-button--icon mdl-button--primary page-control" @click="loadPage(1)">
								<i class="material-icons">first_page</i>
							</button>
							<button :disabled="!firstVisible" class="mdl-button mdl-js-button mdl-button--icon mdl-button--primary page-control" @click="loadPage(currPageNum - 1)">
								<i class="material-icons">chevron_left</i>
							</button>
							<p class="page-control mdl-color-text--primary">Page {{ currPageNum }} of {{ lastPageNum }}</p>
							<button :disabled="!lastVisible" class="mdl-button mdl-js-button mdl-button--icon mdl-button--primary page-control" @click="
							loadPage(currPageNum + 1)">
								<i class="material-icons">chevron_right</i>
							</button>
							<button :disabled="!lastVisible" class="mdl-button mdl-js-button mdl-button--icon mdl-button--primary page-control" @click="loadPage(lastPageNum)">
								<i class="material-icons">last_page</i>
							</button>
						</div>

					</div>
				</div>

			</main>

			<dialog class="mdl-dialog all-pubs-dialog" id="allPubsDialog">
				<p class="mdl-dialog__title">All Publishers</p>
				<div class="mdl-dialog__content all-pubs">
					<div v-for="publ in allPublishers">
						<input type="checkbox" :id="'allPub_'+publ.id" v-model="publ.selected">
						<label :for="'allPub_'+publ.id">{{ publ.publisher }}</label>
					</div>
				</div>
				<div class="mdl-dialog__actions">
					<button type="button" class="mdl-button mdl-color--primary mdl-color-text--white" @click="selectPublishersFromDialog">Apply Filters</button>
					<button type="button" class="mdl-button" @click="closeAllPubsDialog">Cancel</button>
				</div>
			</dialog>

		</div>
	</div>
	<script src="bundle.js"></script>
</body>

</html>